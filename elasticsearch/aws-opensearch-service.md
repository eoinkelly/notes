# AWS OpenSearch


How is it secured?


Option: Put you ES server in private subnet of your VPC

* Normal VPC security protections are in place
* Only traffic originating from VPC can access ES or Kibana
* Uses can only use Kibana if they can somehow get onto the VPC

Option: Make it accessible to Internet

* You can create a "custom endpoint" with an ACM cert as well as the autogenerated endpoint
* You can enable a "compatibility mode" which makes the OS report it's version as ES 7.10 so that clients which check still work
* Auto-tune
  * will automatically **make** changes to your cluster that require no downtime (e.g. tuning queues and cache sizes)
  * you can set a maintenance window so that it can make changes which require a blue/green deploy


Choose
* how many AZ to spread nodes across (1-3)
* instance size for the node
* number of nodes
  * the number you choose here is contstrained by how many AZs you choose
* how much EBS storage per node
* whether (and how many) master nodes you want
* Choose whether to make it Internet accessible or in a VPC
* Choose whether to have "fine grained access control"
  * > Features include document-level security, field-level security, read-only users, and OpenSearch Dashboards/Kibana tenants. Fine-grained access control requires a master user
  * https://docs.aws.amazon.com/opensearch-service/latest/developerguide/fgac.html
* Should Kibana support your existing SAML provider to get users
* Should Kibana support getting users from Cognito
* Set an access policy
  * > Access policies control whether a request is accepted or rejected when it reaches the Amazon OpenSearch Service domain. If you specify an account, user, or role in this policy, you must sign your requests.
  * https://docs.aws.amazon.com/opensearch-service/latest/developerguide/ac.html
* Field data allocation
  * Specifies the percentage of heap space that is allocated to fielddata. By default, this setting is 20.
* Max clause count
  * Specifies the maximum number of allowed boolean clauses in a query. By default, this setting is 1024.



Security access choice

> Choose internet or VPC access. To enable VPC access, we use private IP
> addresses from your VPC, which provides an inherent layer of security. You
> control network access within your VPC using security groups. Optionally, you
> can add an additional layer of security by applying a restrictive access policy.
> Internet endpoints are publicly accessible. If you select public access, you
> should secure your domain with an access policy that only allows specific users
> or IP addresses to access the domain.