# Facebook Access tokens

- https://developers.facebook.com/docs/facebook-login/access-tokens
- provides temporary secure access to the FB APIs
- is an opaque string

There are 4 types of token in Facebook

1. User access token
    - needed whenever an app performs some action on FB on behalf of a user
    - has 2 forms:
        1. short lived (~ 1 hour)
        2. long lived (~ 60 days)
    - access tokens generated by web login are short-lived but you can upgrade
      them to long-lived
    - mobile apps (using native SDK) get long-lived tokens by default
    - obtained via: "login dialog"
2. App Access token
    - needed to make requests to FB APIs on behalf of an app, not a user
    - generated using a pre-agreed secret between the app and Facebook
    - obtained via a server to server HTTP get request to call
    - NB: app access tokens should never be hard-coded into an app that is
      shipped to a client
3. Page access token
    - similar to user access token except it allows read/write to a facebook
      page's data
    - obtained via
        1. Get a _user access token_ for a user who is an admin of the page.
        2. Request the `manage_pages` permission
        3. Get the page access token via the Graph API
    - page access tokens are unique to each page, admin and app
4. Client token
    - an identifier
    - embedded into native mobile binaries and desktop apps
    - it is **not** a secret identifier because it can be retrieved by
      inspecting the binary
    - because it is not secret it can only access a limited subset of the
      app-level APIs
    - it is visible on the App's dashboard on Facebook.com

## Token debugging

2 ways:

1. manually
    ```sh
    # this way shows a bit more info than the facebook debug tool but is a bit less
    # convenient
    https://graph.facebook.com/v2.3/debug_token?access_token={valid-access-token}&input_token={token-to-debug}
    ```
2. facebook debug tool https://developers.facebook.com/tools/debug/

## Token anatomy

A token contains _ expriy date and time _ which app generated the token \* what
permissions the token grants

## Token portability

Tokens are portable! Once you obtain a token you can move it to another machine
and use it elsewhere e.g. token obtained on client can be used on server

## Getting an app access token

To generate an app access token we send our app id and secret FB

```sh
# option 1: get the access_token so you can move it around and re-use it
GET /oauth/access_token?
     client_id={app-id}
    &client_secret={app-secret}
    &grant_type=client_credentials

# returns JSON
{
    "access_token": "{app-id}|{some-secret-string}",
    "token_type": "bearer"
}

# option 2: use `app-id|secret-key` as an inline access token for single shot actions
http://graph.facebook.com/endpoint?key=value&access_token=app_id|app_secret
```

Implictions:

- anyone with the app-id and secret can access Facebook _as_ the app.
- an app doesn't need to access facebook as an app - usually we want the user to
  login to give the app certain permissions

It is important that the app secret never be shared with anybody so this API
call should only be done in _server side code_.

# Cordova facebook plugin

- It only ever does things on behalf of a facebook user, not the app so it
  doesn't need the app secret

## Token expiry

The iOS, Android, JS SDKs take care of refreshing tokens for you if they have
expired

Native SDK tokens are long-lived (good for 60 days) and are refereshed once per
day if you use the app on that day. _ implications: _ if you don't use an app
for 60 days you will have to login again

Access tokens on the web have a lifetime of 2 hours are are automatically
refreshed as required

Your server can take a short-lived token and turn it into a long-lived one by
making a request with the (short-lived token, app id, app secret) which returns
a long-lived token Implications: \* should only be done on the server as it
requires having your app secret
