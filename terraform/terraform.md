To check for updates to plugins and modules (within version constraints):

```
terraform init -upgrade=true
```

# Terraform

Questions

- I presume terraform should have its own IAM user?

Basics

1. you describe your infrastructure in config files
1. terraform generates an execution plan from them
    - before it does it you can inspect
        1. what terrafrom will do
        1. what order it will do it
    - `terrafrom plan` will examine the current state of resources and your
      desired state and show you what actions it intends to take to bring them
      together
    - terraform docs tout this separation of planning & execution phases as an
      advantage of terraform
1. terraform runs the plan
    - it builds a resource graph from your config and it will run any steps it
      can in parallel

Config file format

Docs: https://www.terraform.io/docs/configuration/index.html

- two formats
    1. .tf
        - a text file format (looks a little rubyish fwiw)
        - recommended if config generated by human
    1. .tf.json
        - recommended if config generated by machine

Commands

- `terraform plan`
    - show you want terraform will do on next execution
- `terraform plan -destroy`
    - show what a `terraform destroy` will do
- `terraform graph`
    - show the resource graph
- `terraform apply`
    - actually run the plan
    - it saves the current state of your infrastructure into a .tfstate (JSON)
      file
- `terraform show`
    - inspect current state
- `terraform destroy`
    - destroy the infrastructure

Tutorial

```
cd path/to/config
terraform init
terraform plan
terraform apply
terraform show
terraform destroy
```

> Implicit dependencies via interpolation expressions are the primary way to
> inform Terraform about these relationships, and should be used whenever
> possible

Interesting things

- You can automate Heroku setups with it
- Terraform can provision containers into K8s and friends
- Apparently it works across all the major public clounds
- Designed to be used alongside chef & puppet - it doesn't do config managment
  of a single server

## Handling variables

Terraform provides 3 options for pulling secrets and local settings into the .tf
files

1. CLI arguments (highest precedence, will override any clashing vars)
    - `terraform apply -var 'foo=bar' -var 'access_key=blah'`
2. From a `terraform.tfvars` file
    - terraform automatically finds the file if its called `terraform.tfvars` or
      `*.auto.tfvars`
    - you can specify any file with
      `terraform -var-file secrets.tfvars -var-file ./production.tfvars`
    - can be in JSON format
    - e.g
    ```tf
    foo = "bar"
    access_key = "blah"
    ```
3. TF_VAR_foo environment variables (lowest precedence)
    - Example:
        ```bash
        $ export TF_VAR_access_key=blah;
        $ export TF_VAR_foo=bar;
        $ terraform apply
        ```

Common aspects to variables no matter where they are set

- If the variable has a default value then it is optional, otherwise required
- Access variables via the `${var.NAME_OF_VAR}` syntax (note the var prefix)
- If a string variable (doesn't work for maps and lists) is missing terraform
  will prompt you for it
